<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3D 달력 보드게임</title>
  <style>
    /* 페이지 기본 스타일 */
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      background-color: #87CEEB; /* 하늘색 배경 */
    }

    /* 상단 UI 컨테이너 */
    #ui-container {
      position: absolute;
      top: 10px; 
      left: 50%; 
      transform: translateX(-50%);
      display: flex; 
      gap: 10px; 
      z-index: 10; /* UI가 앞에 표시되도록 */
    }
    button {
      background: #0f3460; 
      color: #fff; 
      border: none; 
      padding: 10px 15px;
      font-size: 16px; 
      cursor: pointer; 
      border-radius: 5px; 
      transition: 0.3s;
    }
    button:hover {
      background: #00c3ff;
    }

    /* 달력 컨테이너 (보드판) */
    #calendar-container {
      position: absolute; 
      top: 60px; 
      left: 50%; 
      transform: translateX(-50%);
      display: grid; 
      grid-template-columns: repeat(7, 60px); /* 7열, 칸 너비 60px */
      gap: 5px; 
      max-width: 500px; 
      z-index: 10; /* 달력도 UI 위에 표시 */
    }
    .day {
      width: 60px; 
      height: 60px; 
      display: flex; 
      flex-direction: column;
      align-items: center; 
      justify-content: center;
      border: 1px solid #ccc; 
      font-size: 16px; 
      background: #fff; 
      border-radius: 5px;
    }
    .sunday {
      background: #ff5757; 
      color: white;
    }
    .saturday {
      background: #579eff; 
      color: white;
    }
    .day span {
      font-size: 12px; 
      color: #666;
    }

    /* Three.js 캔버스 (씬) */
    canvas {
      display: block;
      position: fixed; /* 달력 뒤에 깔림 */
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      z-index: -1; /* UI보다 뒤로 */
    }
  </style>
</head>
<body>

  <!-- 상단 UI: 주사위 굴리기 버튼 -->
  <div id="ui-container">
    <button onclick="rollDice()">🎲 주사위 굴리기</button>
  </div>

  <!-- 달력(보드판) 영역 -->
  <div id="calendar-container"></div>

  <!-- Three.js & TWEEN.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

  <script>
    let scene, camera, renderer;
    let player;               // 보트(플레이어)
    let cubes = [];           // 3D 큐브 배열
    let playerPosition = 0;   // 플레이어의 현재 칸 (0~)
    let waveTime = 0;         // 물결 애니메이션 시간

    // 초기 실행
    function init() {
      // 씬 생성 (배경: 하늘색)
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87CEEB);

      // 카메라 설정 (약간 위에서 내려다보도록)
      camera = new THREE.PerspectiveCamera(
        75, 
        window.innerWidth / window.innerHeight, 
        0.1, 
        1000
      );
      camera.position.set(0, 28, 22);
      camera.lookAt(0, 0, 0);

      // 렌더러 설정
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // 조명 추가
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
      directionalLight.position.set(5, 15, 10);
      scene.add(directionalLight);

      // 달력(보드판) 생성
      createCalendarBoard();

      // 플레이어(보트) 생성
      createBoatPlayer();

      // 이벤트 리스너
      window.addEventListener('resize', onWindowResize);

      // 애니메이션 시작
      animate();
    }

    // 달력(보드판) 생성
    function createCalendarBoard() {
      // 달력 HTML 표시
      const daysInMonth = 31;
      const daysOfWeek = ["일", "월", "화", "수", "목", "금", "토"];
      const calendarContainer = document.getElementById("calendar-container");
      calendarContainer.innerHTML = "";

      // 요일 헤더 7개
      for (let i = 0; i < daysOfWeek.length; i++) {
        const dayHeader = document.createElement("div");
        dayHeader.classList.add("day");
        dayHeader.textContent = daysOfWeek[i];
        if (i === 0) dayHeader.classList.add("sunday");
        if (i === 6) dayHeader.classList.add("saturday");
        calendarContainer.appendChild(dayHeader);
      }

      // 날짜 31개
      let dayCount = 1;
      // 보드판을 5행 x 7열 = 35칸 (31일 + 4칸 남음)
      const rows = 5;
      const cols = 7;

      for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
          if (dayCount > daysInMonth) break;

          // 3D 큐브 생성
          const geometry = new THREE.BoxGeometry(4, 0.5, 4);
          const material = new THREE.MeshStandardMaterial({ color: 0xffffff });
          const cube = new THREE.Mesh(geometry, material);

          // 큐브 배치 (칸을 크게)
          // col=0~6 => x좌표는 (col-3)*4
          // row=0~4 => z좌표는 -(row-2)*4
          let x = (col - 3) * 4;
          let z = -(row - 2) * 4;
          cube.position.set(x, 0, z);

          scene.add(cube);
          cubes.push(cube);

          // HTML 달력 칸
          const dayDiv = document.createElement("div");
          dayDiv.classList.add("day");
          if (col === 0) dayDiv.classList.add("sunday");
          if (col === 6) dayDiv.classList.add("saturday");
          dayDiv.innerHTML = `<strong>${dayCount}</strong><span>${daysOfWeek[col]}</span>`;
          calendarContainer.appendChild(dayDiv);

          dayCount++;
        }
      }
    }

    // 보트(플레이어) 생성
    function createBoatPlayer() {
      const group = new THREE.Group();

      // 1) 보트 본체 (아래쪽 파란 부분)
      const bodyGeometry = new THREE.CylinderGeometry(2, 2.5, 5, 16);
      const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x0077ff });
      const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
      body.rotation.z = Math.PI / 2;
      group.add(body);

      // 2) 상층부 (노란색 객실)
      const deckGeometry = new THREE.BoxGeometry(2.5, 1.8, 2);
      const deckMaterial = new THREE.MeshStandardMaterial({ color: 0xffdd00 });
      const deck = new THREE.Mesh(deckGeometry, deckMaterial);
      deck.position.set(0, 2.5, 0);
      group.add(deck);

      // 3) 창문 (흰색 원)
      const windowGeometry = new THREE.CircleGeometry(0.3, 16);
      const windowMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
      for (let i = -0.7; i <= 0.7; i += 0.7) {
        const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
        windowMesh.position.set(1.5, 2.5, i);
        windowMesh.rotation.y = Math.PI / 2;
        group.add(windowMesh);
      }

      // 4) 돛대 (주황색 기둥)
      const poleGeometry = new THREE.CylinderGeometry(0.1, 0.1, 4, 8);
      const poleMaterial = new THREE.MeshStandardMaterial({ color: 0xff5500 });
      const pole = new THREE.Mesh(poleGeometry, poleMaterial);
      pole.position.set(0, 4, 0);
      group.add(pole);

      // 그룹을 씬에 추가
      player = group;
      scene.add(player);

      // 초기 위치 갱신
      updatePlayerPosition();
    }

    // 플레이어 위치 이동
    function updatePlayerPosition() {
      if (playerPosition < cubes.length) {
        const position = cubes[playerPosition].position;

        // TWEEN으로 부드러운 이동
        new TWEEN.Tween(player.position)
          .to({ x: position.x, y: 1, z: position.z }, 1000)
          .easing(TWEEN.Easing.Sinusoidal.InOut)
          .start();
      }
    }

    // 주사위 굴리기
    function rollDice() {
      const diceValue = Math.floor(Math.random() * 6) + 1;
      playerPosition = Math.min(playerPosition + diceValue, cubes.length - 1);
      updatePlayerPosition();
    }

    // 화면 리사이즈 대응
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // 애니메이션 루프
    function animate() {
      requestAnimationFrame(animate);
      
      // 배 물결 효과
      waveTime += 0.03;
      if (player) {
        player.position.y = 1 + Math.sin(waveTime) * 0.2;
      }

      TWEEN.update();
      renderer.render(scene, camera);
    }

    // 실행
    init();
  </script>
</body>
</html>