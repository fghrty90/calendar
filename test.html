<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 달력 보드게임</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #87CEEB; }
        
        /* UI 스타일 */
        #ui-container {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 10;
        }
        button {
            background: #0f3460; color: #fff; border: none; padding: 10px 15px;
            font-size: 16px; cursor: pointer; border-radius: 5px; transition: 0.3s;
        }
        button:hover { background: #00c3ff; }

        /* 보드판 (달력) 스타일 */
        #calendar-container {
            position: absolute; top: 70px; left: 50%; transform: translateX(-50%);
            display: grid; grid-template-columns: repeat(7, 60px); gap: 5px; max-width: 500px; z-index: 10;
        }
        .day {
            width: 60px; height: 60px; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border: 1px solid #ccc; font-size: 16px; background: #fff; border-radius: 5px;
        }
        .sunday { background: #ff5757; color: white; }
        .saturday { background: #579eff; color: white; }
        .day span { font-size: 12px; color: #666; }

        /* Three.js 캔버스 */
        canvas {
            display: block;
            position: absolute; top: 160px; left: 0; width: 100%; height: calc(100% - 160px);
            z-index: 1;
        }
    </style>
</head>
<body>

    <div id="ui-container">
        <button onclick="rollDice()">🎲 주사위 굴리기</button>
    </div>
    
    <div id="calendar-container"></div>

    <!-- ✅ Three.js & TWEEN.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script>
        let scene, camera, renderer, player, playerPosition = 0;
        let cubes = [];
        let waveTime = 0;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // ✅ 카메라 위치 수정
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 22, 20);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // ✅ 조명 추가 (배와 보드판이 잘 보이도록)
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 15, 10);
            scene.add(ambientLight);
            scene.add(directionalLight);

            createBoard();
            createPlayer();
            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function createBoard() {
            const days = 31;
            const daysOfWeek = ["일", "월", "화", "수", "목", "금", "토"];
            const rows = 5;
            const cols = 7;
            let count = 1;
            const calendarContainer = document.getElementById("calendar-container");
            calendarContainer.innerHTML = "";

            for (let i = 0; i < daysOfWeek.length; i++) {
                const dayHeader = document.createElement("div");
                dayHeader.classList.add("day");
                dayHeader.textContent = daysOfWeek[i];
                if (i === 0) dayHeader.classList.add("sunday");
                if (i === 6) dayHeader.classList.add("saturday");
                calendarContainer.appendChild(dayHeader);
            }

            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (count > days) break;

                    const geometry = new THREE.BoxGeometry(3, 0.5, 3);
                    const material = new THREE.MeshStandardMaterial({ color: 0xffffff });
                    const cube = new THREE.Mesh(geometry, material);
                    
                    let x = (col - 3) * 3;
                    let z = -(row - 2) * 3;
                    cube.position.set(x, 0, z);
                    
                    scene.add(cube);
                    cubes.push(cube);

                    // HTML 달력 업데이트
                    const day = document.createElement("div");
                    day.classList.add("day");
                    if (col === 0) day.classList.add("sunday");
                    if (col === 6) day.classList.add("saturday");
                    day.innerHTML = `<strong>${count}</strong><span>${daysOfWeek[col]}</span>`;
                    calendarContainer.appendChild(day);

                    count++;
                }
            }
        }

        function createPlayer() {
            const group = new THREE.Group();

            // 🚢 본체 (더 둥글게 변경)
            const bodyGeometry = new THREE.CylinderGeometry(1.5, 2, 4, 16);
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x0077ff });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.rotation.z = Math.PI / 2;
            group.add(body);

            // 🚢 상층부 (객실)
            const deckGeometry = new THREE.BoxGeometry(2, 1.5, 2);
            const deckMaterial = new THREE.MeshStandardMaterial({ color: 0xffdd00 });
            const deck = new THREE.Mesh(deckGeometry, deckMaterial);
            deck.position.set(0, 1.8, 0);
            group.add(deck);

            // 🚢 창문
            const windowGeometry = new THREE.CircleGeometry(0.3, 16);
            const windowMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            for (let i = -0.5; i <= 0.5; i += 0.5) {
                const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
                windowMesh.position.set(1.3, 1.8, i);
                windowMesh.rotation.y = Math.PI / 2;
                group.add(windowMesh);
            }

            player = group;
            scene.add(player);
            updatePlayerPosition();
        }

        function rollDice() {
            const diceValue = Math.floor(Math.random() * 6) + 1;
            playerPosition = Math.min(playerPosition + diceValue, cubes.length - 1);
            updatePlayerPosition();
        }

        function animate() {
            requestAnimationFrame(animate);
            waveTime += 0.03;
            player.position.y = 1 + Math.sin(waveTime) * 0.2;
            TWEEN.update();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>