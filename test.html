<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js 배 모양 보드게임</title>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";
        import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/controls/OrbitControls.js";
        import { TWEEN } from "https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.esm.js";

        // 1. 기본 설정
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. 바닥 (물 위) 생성
        const planeGeometry = new THREE.PlaneGeometry(10, 10);
        const planeMaterial = new THREE.MeshBasicMaterial({ color: 0x3399ff, side: THREE.DoubleSide });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        scene.add(plane);

        // 3. 배 모양 플레이어 추가
        function createBoat() {
            const group = new THREE.Group();

            // 배 몸체 (Cylinder)
            const boatBodyGeometry = new THREE.CylinderGeometry(0.5, 0.7, 1.5, 10);
            const boatBodyMaterial = new THREE.MeshStandardMaterial({ color: 0xff8800 });
            const boatBody = new THREE.Mesh(boatBodyGeometry, boatBodyMaterial);
            boatBody.rotation.z = Math.PI / 2;
            group.add(boatBody);

            // 돛 (Cone)
            const sailGeometry = new THREE.ConeGeometry(0.4, 1, 10);
            const sailMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const sail = new THREE.Mesh(sailGeometry, sailMaterial);
            sail.position.set(0, 0.8, 0);
            group.add(sail);

            group.position.set(0, 0.3, 0);
            scene.add(group);
            return group;
        }

        const playerBoat = createBoat();

        // 4. 카메라 위치 조정 (모바일 최적화)
        function updateCamera() {
            if (window.innerWidth < 600) {
                camera.position.set(0, 8, 8);  // 모바일에서 더 멀리 배치
            } else {
                camera.position.set(0, 5, 5);
            }
            camera.lookAt(0, 0, 0);
        }
        updateCamera();
        window.addEventListener('resize', updateCamera);

        // 5. 빛 추가
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 5, 5);
        scene.add(light);

        // 6. OrbitControls 추가
        const controls = new OrbitControls(camera, renderer.domElement);

        // 7. 물결 애니메이션 변수
        let waveTime = 0;

        // 8. 배 이동 함수 (애니메이션 적용)
        function moveBoat(direction) {
            const targetPosition = playerBoat.position.clone();
            if (direction === "up") targetPosition.z -= 1;
            if (direction === "down") targetPosition.z += 1;
            if (direction === "left") targetPosition.x -= 1;
            if (direction === "right") targetPosition.x += 1;

            // Tween.js로 부드러운 이동
            new TWEEN.Tween(playerBoat.position)
                .to({ x: targetPosition.x, y: targetPosition.y, z: targetPosition.z }, 1000)
                .easing(TWEEN.Easing.Sinusoidal.InOut)
                .start();
        }

        // 9. 키보드 이벤트 추가 (이동)
        document.addEventListener("keydown", (event) => {
            if (event.key === "ArrowUp") moveBoat("up");
            if (event.key === "ArrowDown") moveBoat("down");
            if (event.key === "ArrowLeft") moveBoat("left");
            if (event.key === "ArrowRight") moveBoat("right");
        });

        // 10. 모바일 터치 이동
        document.addEventListener("touchstart", (event) => {
            const touchX = event.touches[0].clientX;
            const touchY = event.touches[0].clientY;
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            if (touchX < centerX - 50) moveBoat("left");
            else if (touchX > centerX + 50) moveBoat("right");
            else if (touchY < centerY - 50) moveBoat("up");
            else if (touchY > centerY + 50) moveBoat("down");
        });

        // 11. 애니메이션 루프 (물결 효과 추가)
        function animate() {
            requestAnimationFrame(animate);

            // 물결 효과 적용 (부드러운 위아래 움직임)
            waveTime += 0.03;
            playerBoat.position.y = 0.3 + Math.sin(waveTime) * 0.1;

            controls.update();
            TWEEN.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>