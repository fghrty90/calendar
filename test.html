<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬¼ë•Œ ë³´ë“œê²Œì„</title>
    <style>
        /* * {
            box-sizing: border-box;
        } */

        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            touch-action: none;
            /* ê¸°ë³¸ í„°ì¹˜ ë™ì‘ ë°©ì§€ */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #eee;
            touch-action: none;
        }
        
        .weekday {
            padding: 0.5rem;
            text-align: center;
            font-weight: bold;
            background-color: #000000;
            color: #ffffff;
            border-radius: 5px;
        }
        
        .weekday.first-day {
            background-color: #ff0000;
        }
        .weekday.last-day {
            background-color: #0000ff;
        }
        .day {
            padding: 10px;
            min-height: 80px;
            background: white;
            position: relative;
            touch-action: none;
        }

        .date {
            font-size: 1.2em;
        }

        .tide {
            color: #2563eb;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .players {
            position: absolute;
            bottom: 5px;
            left: 5px;
            display: contents;
            gap: 5px;
        }

        .player {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: move;
            touch-action: none;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .player.dragging {
            opacity: 0.5;
            transform: scale(1.1);
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .dice {
            font-size: 2em;
            margin: 10px 0;
        }

        .button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .button:disabled {
            background: #ccc;
        }

        .game-log {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            padding: 10px;
            margin-top: 10px;
        }

        .setup {
            text-align: center;
            margin: 20px 0;
        }

        .setup input {
            padding: 5px;
            margin: 0 10px;
            width: 60px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="setup" class="setup">
            <h2>ë¬¼ë•Œ ë³´ë“œê²Œì„</h2>
            <div>
                <label>í”Œë ˆì´ì–´ ìˆ˜: </label>
                <input type="number" id="playerCount" min="2" max="6" value="2">
                <button class="button" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
            </div>
        </div>
        

        <div id="game" style="display: none;">
            <button class="button" onclick="reGame()">ë‹¤ì‹œ ì‹œì‘</button>

            <div class="header">
                <h2 id="currentMonth"></h2>
            </div>

            <div class="calendar" id="calendar">
                <div class="weekday first-day">ì¼</div>
                <div class="weekday">ì›”</div>
                <div class="weekday">í™”</div>
                <div class="weekday">ìˆ˜</div>
                <div class="weekday">ëª©</div>
                <div class="weekday">ê¸ˆ</div>
                <div class="weekday">í† </div>
            </div>

            <!-- <div class="controls">
                <h3 id="currentPlayer"></h3>
                <div class="dice" id="dice">ğŸ²</div>
                <button class="button" onclick="rollDice()" id="rollButton">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                <div class="game-log" id="gameLog"></div>
            </div> -->
        </div>
    </div>

    <script>
        let players = [];
        let currentPlayer = 0;
        let isRolling = false;
        let diceValue = 0;
        let draggingElement = null;
        let touchStartX = 0;
        let touchStartY = 0;

        // ë¬¼ë•Œ ê³„ì‚° í•¨ìˆ˜
        function getTide(day) {
            const tideDay = day % 15;
            if (tideDay === 0) return 'ë¬´ì‹œ';
            if (tideDay === 7 || tideDay === 8) return 'ì¡°ê¸ˆ';
            if (tideDay < 7) return `${tideDay}ë¬¼`;
            return `${15 - tideDay}ë¬¼`;
        }
        
        // ê²Œì„ ì‹œì‘
        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            if (playerCount < 2 || playerCount > 6) {
                alert('í”Œë ˆì´ì–´ ìˆ˜ëŠ” 2-6ëª…ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            players = Array(playerCount).fill(0).map((_, i) => ({
                id: i + 1,
                position: 1,
                color: `hsl(${(360 / playerCount) * i}, 70%, 50%)`
            }));

            document.getElementById('setup').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            // currentPlayer = 0;
            updateBoard();
            // addLog('ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        function reGame() {
            document.getElementById('setup').style.display = 'block';
            document.getElementById('game').style.display = 'none';
        }
        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
        // function rollDice() {
        //     if (isRolling) return;
        //     isRolling = true;
        //     document.getElementById('rollButton').disabled = true;

        //     let rolls = 0;
        //     const rollInterval = setInterval(() => {
        //         diceValue = Math.floor(Math.random() * 6) + 1;
        //         document.getElementById('dice').textContent = `ğŸ² ${diceValue}`;
        //         rolls++;

        //         if (rolls > 10) {
        //             clearInterval(rollInterval);
        //             isRolling = false;
        //             document.getElementById('rollButton').disabled = false;
        //             // highlightValidMoves(diceValue);
        //         }
        //     }, 100);
        // }

        // ìœ íš¨í•œ ì´ë™ ìœ„ì¹˜ í•˜ì´ë¼ì´íŠ¸
        // function highlightValidMoves(steps) {
        //     const player = players[currentPlayer];
        //     const validPosition = Math.min(player.position + steps, 31);

        //     document.querySelectorAll('.day').forEach(day => {
        //         day.classList.remove('valid-drop');
        //         const dayNumber = parseInt(day.getAttribute('data-day'));
        //         if (dayNumber === validPosition) {
        //             day.classList.add('valid-drop');
        //         }
        //     });
        // }

        // ë“œë˜ê·¸ ì‹œì‘
        function handleDragStart(e) {
            // if (!diceValue || e.target.getAttribute('data-player-id') != currentPlayer + 1) return;
            draggingElement = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.id);
        }

        // í„°ì¹˜ ì‹œì‘
        function handleTouchStart(e) {
            // if (!diceValue || e.target.getAttribute('data-player-id') != currentPlayer + 1) return;
            currentPlayer = e.target.getAttribute('data-player-id');
            const touch = e.touches[0];
            draggingElement = e.target;
            draggingElement.classList.add('dragging');
            touchStartX = draggingElement.offsetLeft;
            touchStartY = draggingElement.offsetTop - players.length * 25;

            // í„°ì¹˜ ì¤‘ì¸ ë§ì„ ìµœìƒìœ„ë¡œ
            draggingElement.style.position = 'fixed';
            draggingElement.style.zIndex = '1000';
        }

        // í„°ì¹˜ ì´ë™
        function handleTouchMove(e) {
            if (!draggingElement) return;
            e.preventDefault();

            const touch = e.touches[0];
            draggingElement.style.left = `${touch.clientX - touchStartX}px`;
            draggingElement.style.top = `${touch.clientY - touchStartY}px`;

            // í˜„ì¬ í„°ì¹˜ ìœ„ì¹˜ì˜ ì—˜ë¦¬ë¨¼íŠ¸ í™•ì¸
            const touchLocation = document.elementFromPoint(touch.clientX, touch.clientY - players.length * 20);
            const dayElement = touchLocation.closest('.day');

            // ìœ íš¨í•œ ë“œë¡­ ìœ„ì¹˜ í‘œì‹œ
            document.querySelectorAll('.day').forEach(day => {
                day.classList.remove('current-drop-target');
            });
            if (dayElement && dayElement.classList.contains('valid-drop')) {
                dayElement.classList.add('current-drop-target');
            }
        }

        // í„°ì¹˜ ì¢…ë£Œ
        function handleTouchEnd(e) {
            if (!draggingElement) return;
            const touch = e.changedTouches[0];
            const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY - players.length * 20);
            const dayElement = dropTarget.closest('.day');

            if (dayElement && dayElement.classList.contains('valid-drop')) {
                const newPosition = parseInt(dayElement.getAttribute('data-day'));
                handleMove(newPosition);
            }

            // ë“œë˜ê¹… ìƒíƒœ ì´ˆê¸°í™”
            draggingElement.style.position = '';
            draggingElement.style.left = '';
            draggingElement.style.top = '';
            draggingElement.style.zIndex = '';
            draggingElement.classList.remove('dragging');
            draggingElement = null;

            // document.querySelectorAll('.day').forEach(day => {
                // day.classList.remove('current-drop-target');
                // day.classList.remove('valid-drop');
            // });
        }

        // ë“œë¡­ ì²˜ë¦¬
        function handleDrop(e) {
            e.preventDefault();
            const dayElement = e.target.closest('.day');
            if (!dayElement || !dayElement.classList.contains('valid-drop')) return;

            const newPosition = parseInt(dayElement.getAttribute('data-day'));
            handleMove(newPosition);
        }

        // ì´ë™ ì²˜ë¦¬
        function handleMove(newPosition) {
            console.log(currentPlayer);
            const player = players[currentPlayer-1];
            // let message = `í”Œë ˆì´ì–´ ${player.id}ê°€ ${newPosition}ì¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.`;

            const tide = getTide(newPosition);
            // if (tide === 'ë¬´ì‹œ') {
            //     newPosition = 1;
            //     message += ' â†’ ë¬´ì‹œì— ê±¸ë ¤ 1ì¼ë¡œ ì´ë™í•©ë‹ˆë‹¤!';
            // }

            players[currentPlayer-1].position = newPosition;
            // addLog(message);

            // currentPlayer = (currentPlayer + 1) % players.length;
            diceValue = 0;
            updateBoard();
        }

        // ê²Œì„ ë¡œê·¸ ì¶”ê°€
        // function addLog(message) {
            // const log = document.getElementById('gameLog');
            // const entry = document.createElement('div');
            // entry.textContent = message;
            // log.appendChild(entry);
            // log.scrollTop = log.scrollHeight;
        // }

        // ë³´ë“œ ì—…ë°ì´íŠ¸
        function updateBoard() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = `
                <div class="weekday first-day">ì¼SUN</div>
                <div class="weekday">ì›”MON</div>
                <div class="weekday">í™”TUE</div>
                <div class="weekday">ìˆ˜WED</div>
                <div class="weekday">ëª©THU</div>
                <div class="weekday">ê¸ˆFRI</div>
                <div class="weekday last-day">í† SAT</div>
            `;

            const firstDay = new Date(2024, 0, 1).getDay();

            // ì´ì „ ë‹¬ì˜ ë¹ˆ ì¹¸
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day';
                calendar.appendChild(emptyDay);
            }

            // í˜„ì¬ ë‹¬ì˜ ë‚ ì§œ
            for (let day = 1; day <= 31; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day valid-drop';
                dayElement.setAttribute('data-day', day);

                const dateDiv = document.createElement('div');
                dateDiv.className = 'date';
                dateDiv.textContent = day;

                const tideDiv = document.createElement('div');
                tideDiv.className = 'tide';
                tideDiv.textContent = getTide(day);

                const playersDiv = document.createElement('div');
                playersDiv.className = 'players';

                players.forEach(player => {
                    if (player.position === day) {
                        const playerMarker = document.createElement('div');
                        playerMarker.className = 'player';
                        playerMarker.setAttribute('data-player-id', player.id);
                        playerMarker.style.backgroundColor = player.color;
                        playerMarker.textContent = player.id;
                        playerMarker.draggable = true;

                        // ë“œë˜ê·¸ ì´ë²¤íŠ¸
                        playerMarker.addEventListener('dragstart', handleDragStart);
                        // í„°ì¹˜ ì´ë²¤íŠ¸
                        playerMarker.addEventListener('touchstart', handleTouchStart);
                        playersDiv.appendChild(playerMarker);
                    }
                });

                dayElement.appendChild(dateDiv);
                dayElement.appendChild(tideDiv);
                dayElement.appendChild(playersDiv);
                
                // ë“œë¡­ ì´ë²¤íŠ¸
                dayElement.addEventListener('dragover', e => e.preventDefault());
                dayElement.addEventListener('drop', handleDrop);
                
                calendar.appendChild(dayElement);
            }
            // document.getElementById('currentMonth').textContent = '2024ë…„ 1ì›”';
            // document.getElementById('currentPlayer').textContent = `í”Œë ˆì´ì–´ ${currentPlayer + 1}ì˜ í„´`;
        }

        // í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd);
    </script>
</body>

</html>